+++
title = "RAM マップ"
date = 2022-07-09
+++

## 概要

|アドレス|型|内容|
|--|--|--|
|`$00-$01`||雑用|
|`$02-$07`||(未使用)|
|`$08`|`u8`|ルーチン `$EFA7` への引数 (下位 CHR-ID)|
|`$09`|`u8`|ルーチン `$EFA7` への引数 (上位 CHR-ID)|
|`$0A-$0D`||雑用|
|`$0E`|`u8`|PRG バンク切り替え時の PRG-ID 記録用|
|`$0F`|`u8`|ソフトウェアスタック (ページ 7) 用スタックポインタ|
|`$10-$17`||雑用|
|`$18`|`u8`|NMI 制御用|
|`$19-$1B`||(未使用)|
|`$1C-$24`||雑用|
|`$25`|`u8`|NMI カウンタ|
|`$26-$2D`||雑用|
|`$2E-$30`||(未使用)|
|`$31`|`u8`|乱数生成器の戻り値|
|`$32`|`u8`|乱数生成器の内部状態|
|`$33-$34`||雑用|
|`$35`||(未使用)|
|`$36`|`u8`||
|`$37`|`ptr`||
|`$39-$3F`||(未使用)|
|`$40-$47`||雑用|
|`$48-$4C`||(未使用)|
|`$4D-$5A`||雑用|
|`$5B-$5F`||(未使用)|
|`$60-$66`||雑用|
|`$67`||(未使用)|
|`$68-$6B`||雑用|
|`$6C-$7F`||(未使用)|
|`$80-$83`||雑用|
|`$84-$88`|`u8[5]`|数値の10進フォーマット用バッファ|
|`$89`|`u8`||
|`$8A`|`u8`||
|`$8B`|`u8`||
|`$8C`|`u8`||
|`$8D`|`u8`||
|`$8E`||(未使用)|
|`$8F`|`u8`||
|`$90-$9F`||(未使用)|
|`$A0-$B6`||雑用|
|`$B7-$BE`||(未使用)|
|`$BF-$E8`||雑用|
|`$E9-$EF`||(未使用)|
|`$F0`|`u8`||
|`$F1-$F4`||(未使用)|
|`$F5`|`u8`|1P エッジ入力 (ABSTUDLR)|
|`$F6`|`u8`|2P エッジ入力 (ABSTUDLR)|
|`$F7`|`u8`|1P 生入力 (ABSTUDLR)|
|`$F8`|`u8`|2P 生入力 (ABSTUDLR)|
|`$F9`||(未使用)|
|`$FA`|||
|`$FB`||常に 0|
|`$FC`||PPU スクロールx 退避用|
|`$FD`||PPU スクロールy 退避用|
|`$FE`||PPU `$2001` 退避用|
|`$FF`||PPU `$2000` 退避用|
|`$0100-$01FF`||スタック領域|
|`$0200-$02FF`|`Sprite[64]`|スプライトバッファ|
|`$0300-$03FF`|||
|`$0400-$041F`|||
|`$0420-$0421`||雑用|
|`$0422-$0423`||(未使用)|
|`$0424`|`u16`||
|`$0426-$0427`||(未使用)|
|`$0428`|`u8`||
|`$0429`|`u8`||
|`$042A-$042D`||(未使用)|
|`$042E`|`u8`|壊滅した敵艦隊の数|
|`$042F`|`u8`|壊滅した味方艦隊の数|
|`$0430`|`u8`|戦闘における敵の攻撃力|
|`$0431`|`u8`|戦闘における味方の攻撃力|
|`$0432-$0433`||(未使用)|
|`$0434`|`u8`|戦闘における味方のフォーメーション (補正前、`1..=7`)|
|`$0435`|`u8`|戦闘における敵のフォーメーション (補正前、`1..=7`)|
|`$0436`|`u8`||
|`$0437`|`u8`||
|`$0438`||(未使用)|
|`$0439`|`u8`||
|`$043A`|`u8`||
|`$043B`|`u8`||
|`$043C`|`u8`|現在の戦闘が行われている惑星ID|
|`$043D`|`u8`||
|`$043E`|`u8`|現在の戦闘に参加している味方艦隊数 (`$04CC` と同じ値)|
|`$043F`|`u8`|現在の戦闘に参加している敵艦隊数 (駐留艦隊含む。`$04CB` と同じ値)|
|`$0440`|`u16`||
|`$0442`|`u16`||
|`$0444`|`u8`|(未使用。常に 0x32)|
|`$0445`|`u8`||
|`$0446`|`u8`||
|`$0447`|`u8`||
|`$0448`|`u16`|経過日数 (表示時は上位 8bit が無視される))|
|`$0449`||(未使用)|
|`$044A`|`u8`|キルヒアイスによるリセット勧告を既に行ったか (0:false, 0xFF:true)|
|`$044B-$047F`||(未使用)|
|`$0480-$049F`|||
|`$04A0`|`u8[8]`|[味方艦隊構造体B](#ally-struct-b)または[敵艦隊構造体B](#enemy-struct-b)を展開するバッファ|
|`$04A8-$04AF`||(未使用)|
|`$04B0`|`u8[16]`|[味方艦隊構造体A](#ally-struct-a)または[敵艦隊構造体A](#enemy-struct-a)を展開するバッファ|
|`$04C0`|`u8`|現在処理している艦隊の番号 (1-based)|
|`$04C1`|`u8`|現在処理している艦隊の指揮官名に対応する単語ID|
|`$04C2`|`u8`|現在処理している艦隊の現在地または目的地の惑星|
|`$04C3`|`u8`|現在処理している艦隊の移動力 (write-only)|
|`$04C4`|`u8`|現在処理している艦隊の何らかの属性 (write-only)|
|`$04C5`|`u8`|現在処理している艦隊の疲労度|
|`$04C6`|`u8`|現在処理している艦隊のエネルギー|
|`$04C7`|`u8`|現在処理している艦隊の食料|
|`$04C8`|`u8`|現在処理している艦隊のダメージ|
|`$04C9`|`u8`|現在処理している艦隊のコマンド|
|`$04CA`|`u8`|現在処理している艦隊の目的地 (write-only)|
|`$04CB`|`u8`|現在の戦闘に参加している敵艦隊数 (駐留艦隊含む。`$043F` と同じ値)|
|`$04CC`|`u8`|現在の戦闘に参加している味方艦隊数 (`$043E` と同じ値)|
|`$04CD`|`u16`|敵兵力を隻数に変換した結果|
|`$04CF`|`u16`|味方兵力を隻数に変換した結果|
|`$04D1`||(未使用)|
|`$04D2`|`u8`|味方艦隊が惑星に到着した際、隣接する 4 つの惑星のうち無補給で行ける惑星の数(エネルギー不足判定用)|
|`$04D3`|`u8`|現在処理している艦隊の輸送待ち日数|
|`$04D4`|`u8`|現在処理している艦隊のインデックス (メモリ上での並び順と一致する)|
|`$04D5`|`u8`||
|`$04D6`|`u8[4]`|現在処理している艦隊が到着した惑星に隣接する 4 つの惑星ID|
|`$04DA`|`u8`||
|`$04DB`|`u16`||
|`$04DD`|`u16`||
|`$04DF`|`u8`|現在処理している艦隊のアクシデントID (アクシデントが起こっていなければ 0xFF)|
|`$04E0`||雑用|
|`$04E1`|`u8`|現在処理している艦隊の偵察先惑星ID|
|`$04E2`|`u8`|現在処理している艦隊の偵察先惑星への見積もり所要日数|
|`$04E3`|`u8`|現在処理している艦隊の偵察先で発見した敵艦隊の番号 (1-based)|
|`$04E4`|`u8`|現在処理している艦隊の偵察先で発見した敵艦隊の指揮官名に対応する単語ID|
|`$04E5`||(未使用)|
|`$04E6`|||
|`$04E7`|`u8`|現在の戦闘にヤンが参加しているかどうか (0:false, 0xFF:true)|
|`$04E8`|`u8`|ヤンが戦闘している惑星ID (ヤンが戦闘していなければ 0xFF)|
|`$04E9`|`u8`|キルヒアイスによる疲労度関連メッセージ選択用カウンタ|
|`$04EA-$04EE`||(未使用)|
|`$04EF`||雑用|
|`$04F0-$04FF`||(未使用)|
|`$0500-$0505`||雑用|
|`$0506-$050F`||(未使用)|
|`$0510-$05FF`|||
|`$0600-$06FF`|||
|`$0700-$07FF`|||
|`$6000-$604F`|||
|`$6050-$614F`|`u8[16][16]`|[味方艦隊構造体A](#ally-struct-a)の配列|
|`$6150-$624F`|`u8[16][16]`|[敵艦隊構造体A](#enemy-struct-a)の配列|
|`$6250-$62CF`|`u8[8][16]`|[味方艦隊構造体B](#ally-struct-b)の配列|
|`$62D0-$634F`|`u8[8][16]`|[敵艦隊構造体B](#enemy-struct-b)の配列|
|`$6350-$63FF`||(未使用)|
|`$6400-$647F`|`u8[4][32]`|[惑星構造体](#planet-struct)の配列|
|`$6480-$64FF`||(未使用)|
|`$6500-$657F`|||
|`$6580-$658F`|`u8[16]`|現在の戦闘に参加している味方艦隊インデックスの配列 (0xFF 終端)|
|`$6590-$659F`|`u8[16]`|現在の戦闘に参加している敵艦隊インデックスの配列 (0xFF 終端)|
|`$65A0-$65BF`||(未使用)|
|`$65C0-$65C7`|||
|`$65C8`|`u8`||
|`$65C9`|`u8`||
|`$65CA-$65CF`||(未使用)|
|`$65D0-$65EF`|`u8[32]`|各惑星の敵フォーメーション (不変)|
|`$65F0-$65FF`||(未使用)|
|`$6600-$661F`|`u8[32]`|各惑星に対応するデータ (write-only)|
|`$6620-$663F`|`u8[32]`|各惑星の駐留艦隊の兵力|
|`$6640-$6FFF`||(未使用)|
|`$7000-$73FF`|||
|`$7400-$7FFF`||(未使用)|


## データ構造

### 味方艦隊構造体A (len: 16) {#ally-struct-a}

|オフセット|型|内容|
|--|--|--|
|`0`|||
|`1`|`u8`|座標x|
|`2`|`u8`|座標y|
|`3`|`u8`|座標z|
|`4`|`u8`|偵察先惑星ID|
|`5`|`u8`|食料|
|`6`|`u8`|輸送待ち日数|
|`7`|`u8`|疲労度|
|`8`|`u8`|エネルギー|
|`9`|`u8`|ダメージ|
|`10`|||
|`11`|`u8`|移動力|
|`12-15`|||

### 敵艦隊構造体A (len: 16) {#enemy-struct-a}

|オフセット|型|内容|
|--|--|--|
|`0`|||
|`1`|`u8`|座標x|
|`2`|`u8`|座標y|
|`3`|`u8`|座標z|
|`4-6`|||
|`7`|`u8`|疲労度|
|`8`|||
|`9`|`u8`|ダメージ|
|`10`|||
|`11`|`u8`|移動力|
|`12`|||
|`13`|`u8`|マーク対象の味方艦隊インデックス (write-only)|
|`14-15`|||

### 味方艦隊構造体B (len: 8) {#ally-struct-b}

|オフセット|型|内容|
|--|--|--|
|`0`|`u8`|状態 (bit0:?, bit1:敵艦隊によりマークされている, bit2-4:?, bit5:コマンド入力済み, bit6:惑星に滞在中, bit7:健在)|
|`1-4`|||
|`5`|`u8`|現在地または目的地の惑星ID|
|`6`|`u8`|コマンド (0:移動, 1:偵察, 2:休息, 3:補給, 4:戦闘, 5:退却, 6:停止)|
|`7`|`u8`|味方艦隊インデックス (メモリ上での並び順と一致する)|

### 敵艦隊構造体B (len: 8) {#enemy-struct-b}

|オフセット|型|内容|
|--|--|--|
|`0`|`u8`|状態 (bit0-5:?, bit6:惑星に滞在中, bit7:健在)|
|`1-4`|||
|`5`|`u8`|現在地または目的地の惑星ID|
|`6`|`u8`|戦略ID (通常は `0..=3`)|
|`7`|`u8`|敵艦隊インデックス (メモリ上での並び順と一致する)|

### 惑星構造体 (len: 4) {#planet-struct}

|オフセット|型|内容|
|--|--|--|
|`0`|`u8`|座標x (不変)|
|`1`|`u8`|座標y (不変)|
|`2`|`u8`|座標z (不変)|
|`3`|`u8`|敵の退却先などに関係 (可変)|
